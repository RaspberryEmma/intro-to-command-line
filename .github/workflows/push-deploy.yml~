name: Create static pages and send them to deploy repo

on:
  push:
    branches:
      - master

jobs:

  build-and-deploy:

    runs-on: ubuntu-20.04

    steps:

    - name: checkout repo & submodules
      uses: actions/checkout@v2
      with:
        submodules: true
        fetch-depth: 0

    - name: Build website
      run: |
        wget https://github.com/gohugoio/hugo/releases/download/v0.98.0/hugo_extended_0.98.0_Linux-64bit.deb
        sudo dpkg -i hugo_extended_0.98.0_Linux-64bit.deb
        hugo -t LoveIt
        rm hugo_extended_0.98.0_Linux-64bit.deb
      working-directory: intro-to-command-site

    - name: Push contents of `intro-to-command-site/public` to gh-pages branch
      run: |
        git config user.name "github-action"
        git config user.email "github-action"
        git checkout gh-pages
        rm -rf docs/*
        cp -rT intro-to-command-site/public docs
        git add .
        git commit -m "deploy site" || echo "No changes to commit"
        git push

